using System;
using System.IO;
using System.Reflection;

namespace NitroxModel.Core;

/// <summary>
///     Environment helper for getting meta data about where and how Nitrox is running.
/// </summary>
public static class NitroxEnvironment
{
    private static bool hasSet;
    public static string ReleasePhase => IsReleaseMode ? "Alpha" : "InDev";
    public static Version Version => Assembly.GetExecutingAssembly().GetName().Version;
    public static DateTime BuildDate => File.GetCreationTimeUtc(Assembly.GetExecutingAssembly().Location);

    public static Types Type { get; private set; } = Types.NORMAL;
    public static bool IsTesting => Type == Types.TESTING;
    public static bool IsNormal => Type == Types.NORMAL;

    public static int CurrentProcessId
    {
        get
        {
#if NET9_0_OR_GREATER
            return Environment.ProcessId;
#else
            using System.Diagnostics.Process process = System.Diagnostics.Process.GetCurrentProcess();
            return process.Id;
#endif
        }
    }

    public static bool IsReleaseMode
    {
        get
        {
#if RELEASE
                return true;
#else
            return false;
#endif
        }
    }

    public static void Set(Types value)
    {
        if (hasSet)
        {
            throw new Exception("Environment type can only be set once");
        }

        Type = value;
        hasSet = true;
    }

    public enum Types
    {
        NORMAL,
        TESTING
    }
}
